---
title: "Ash Content Analysis"
author: "Trevor Eakes"
date: "`r Sys.Date()`"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, warning = FALSE, message = FALSE)
```

## Load Required Packages

```{r script}
source("process_plate_run.R")
```

## Load the Data

```{r load-data}
ash_data <- read_excel("ash_final.xlsx", sheet = 1)
head(ash_data)
```

## Clean and Prepare Data

```{r clean-data}
ash_clean <- ash_data %>%
  select(same_id, rep_id, ash_per) %>%
  mutate(ash_per = as.numeric(ash_per)) %>%
  drop_na()
```

## Summary Statistics by Replicate

```{r summary-stats}
analyze_replicates(ash_clean,
                  id_col = "ID",
                  join_col = "join_id",
                               weight_col = "sample weight",
                               date_col = "date",
                               output_prefix = "all_rep_analy",
                                choose_best_3 = FALSE)
```

## Bar Plot with Error Bars

```{r plot-bar}
ash_plot <- ggplot(ash_summary, aes(x = reorder(same_id, -mean_ash_percent), y = mean_ash_percent)) +
  geom_col(fill = "skyblue") +
  geom_errorbar(aes(ymin = mean_ash_percent - sd_ash_percent, ymax = mean_ash_percent + sd_ash_percent), width = 0.2) +
  labs(title = "Ash Content by Replicate Group", x = "Replicate Group", y = "Mean Ash %") +
  theme_classic() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))

ash_plot
```

## Interactive Plot

```{r plotly-bar, results='asis'}
plotly::ggplotly(ash_plot)
```

## Save Summary to CSV

```{r export-summary, eval=FALSE}
write.csv(ash_summary, "ash_summary_by_replicate.csv", row.names = FALSE)