---
title: "Protein Content Analysis using the Lowry Method"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, warning = FALSE, message = FALSE)
```
## Load Required Libraries and Functions
```{r}
required_packages <- c(
  'readxl', 'dplyr', 'tidyr', 'ggplot2', 'broom', 'purrr',
  'stringr', 'zoo', 'ggpubr', 'plotly', 'here'
)
for(pkg in required_packages) {
  if (!requireNamespace(pkg, quietly = TRUE)) install.packages(pkg)
  library(pkg, character.only = TRUE)
}
# Source your script with helper functions
source('scripts/process_plate_run.R')
```
## Load and Tidy Protein Data
```{r}
# Load data (this function will take the second sheet if available)
load_excel_files("data")  # Adjust folder path as needed

# Tidy and correct using blank wells A01 and B01
protein_tidy <- tidy_and_correct(PROTEINA_9_5_25, blanks = c("A01", "B01"))
```
## Create Standard Curve from Lowry Assay
```{r}
standards <- data.frame(
  concentration_mg_per_ml = c(0, 0.1, 0.2, 0.4, 0.6, 0.8, 1.0),
  absorbance = c(0.05, 0.15, 0.25, 0.45, 0.65, 0.85, 1.05)  # Adjust as needed
)
lowry_model <- lm(absorbance ~ concentration_mg_per_ml, data = standards)
summary(lowry_model)

# Plot standard curve
ggplot(standards, aes(x = concentration_mg_per_ml, y = absorbance)) +
  geom_point() +
  geom_smooth(method = 'lm') +
  labs(title = 'Lowry Standard Curve',
       x = 'Protein Concentration (mg/mL)',
       y = 'Absorbance') +
  theme_minimal()
```
## Estimate Protein Content
```{r}
# Calculate protein based on absorbance at 600 nm
protein_tidy <- protein_tidy %>%
  mutate(Protein_mg_per_mL = (X600 - coef(lowry_model)[1]) / coef(lowry_model)[2])

# Create dummy metadata if not already available
protein_tidy <- protein_tidy %>%
  mutate(ID = Cell_ID,
         `sample weight` = 10,  # Change as needed
         date = as.Date("2025-05-09"),
         join_id = Cell_ID)
```
## Analyze Replicates
```{r}
rep_summary <- analyze_replicates(protein_tidy,
                                  id_col = "ID",
                                  join_col = "join_id",
                                  weight_col = "sample weight",
                                  date_col = "date",
                                  output_prefix = "protein_analysis",
                                  choose_best_3 = TRUE)
```
## Visualize Protein Content Across Replicates
```{r}
graph_replicates_custom_error(rep_summary,
                              id_col = "ID",
                              value_col = "Protein_mg_per_mL_mean",
                              se_col = "Protein_mg_per_mL_se")
```